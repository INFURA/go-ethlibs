package eth_test

import (
	"encoding/json"
	"testing"

	"github.com/stretchr/testify/require"

	"github.com/INFURA/go-ethlibs/eth"
)

// NOTE: This file is NOT autogenerated
func TestBlock_DeepCopy(t *testing.T) {
	// full block from parity on Kovan so has extra fields
	full := `{
    "author": "0x007733a1fe69cf3f2cf989f81c7b4cac1693387a",
    "difficulty": "0xfffffffffffffffffffffffffffffffe",
    "extraData": "0xde830203028f5061726974792d457468657265756d86312e33312e31826c69",
    "gasLimit": "0x7a1200",
    "gasUsed": "0x2276e2",
    "hash": "0x0c58244f5d538e1f5840c6751c3b3a2c9fdf9583245918b224c6aad088de6e5a",
    "logsBloom": "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
    "miner": "0x007733a1fe69cf3f2cf989f81c7b4cac1693387a",
    "number": "0x9de762",
    "parentHash": "0x7a3cce2e8ad99c92171adc9437d41eddd9e425f33b55b850528b6a9901ef0f9e",
    "receiptsRoot": "0x80add7251de396e7f6dd684e4d1be6823bdb867e96a9586c65a6f6c03659fad0",
    "sealFields": [
      "0x841718d07d",
      "0xb841e3d53556d6af10a059dd0d0d4bad2b10e3389ae08c83318b053cf04fac5c69676e96bee369cb3c11a926bbaeb25aa3ce80a101bd2d9db6f6f014b3ccbbfd7c4e00"
    ],
    "sha3Uncles": "0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347",
    "signature": "e3d53556d6af10a059dd0d0d4bad2b10e3389ae08c83318b053cf04fac5c69676e96bee369cb3c11a926bbaeb25aa3ce80a101bd2d9db6f6f014b3ccbbfd7c4e00",
    "size": "0x2bb9",
    "stateRoot": "0x4d301d25429a2114965ce829e2c8b96b69ab826aca09aafa7fe71428d5545651",
    "step": "387502205",
    "timestamp": "0x5c6341f4",
    "totalDifficulty": "0x9ba45300000000000000000000000484a0394a",
    "transactions": [
      {
        "blockHash": "0x0c58244f5d538e1f5840c6751c3b3a2c9fdf9583245918b224c6aad088de6e5a",
        "blockNumber": "0x9de762",
        "chainId": "0x2a",
        "condition": null,
        "creates": null,
        "from": "0xd22abf44e2e2b3a9da3b84383c894f936925333c",
        "gas": "0x7a1200",
        "gasPrice": "0x3b9aca00",
        "hash": "0xd329c3a8ed5e59d649db90a1ff6c4fb632f2f5b925aedd1baa4d84b6f6b9e2f2",
        "input": "0x1a4813d700000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000009de76000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002097035c1f04f1a223413cbe3132300000000000000000000000000000000000062cb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002f69acd420fb6e6de34ec361ceddd000000000000000000000000000000000000a637000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001",
        "nonce": "0x2501b",
        "publicKey": "0xd1c9ae85381ad59eb19d55a0df58e5c0d3599d3a3766347526fd3902ad98146e89694746668c36d59378d72b4710e7f35389bd8c931390a4b908d0d84a1949bb",
        "r": "0x1686aacc780ad5a1805738bd87c709f3c0fbd5c8283be6f454aabefead5d5910",
        "raw": "0xf902cd8302501b843b9aca00837a1200945717adf502fd8830456bd5dc26801a4db394e6b280b902641a4813d700000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000009de76000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002097035c1f04f1a223413cbe3132300000000000000000000000000000000000062cb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002f69acd420fb6e6de34ec361ceddd000000000000000000000000000000000000a63700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000177a01686aacc780ad5a1805738bd87c709f3c0fbd5c8283be6f454aabefead5d5910a002d0e9cee44425e63560ce16768d8a52552ae4b386a957bdbf5e518b438e2641",
        "s": "0x2d0e9cee44425e63560ce16768d8a52552ae4b386a957bdbf5e518b438e2641",
        "standardV": "0x0",
        "to": "0x5717adf502fd8830456bd5dc26801a4db394e6b2",
        "transactionIndex": "0x0",
        "v": "0x77",
        "value": "0x0"
      },
      {
        "blockHash": "0x0c58244f5d538e1f5840c6751c3b3a2c9fdf9583245918b224c6aad088de6e5a",
        "blockNumber": "0x9de762",
        "chainId": null,
        "condition": null,
        "creates": null,
        "from": "0xb3683b4de1fc502807464b55d151e8e2d2c19cb5",
        "gas": "0xf4240",
        "gasPrice": "0x3b9aca00",
        "hash": "0x9535a683436191e42f5a4371c1c3fe6be07964e858f52d876d9e5c06e04233f5",
        "input": "0x28fbdf0d000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000040376634613461663166336262326163646366313062656339636463336337636639313061303030336365323739313866366565323964376436626130353964360000000000000000000000000000000000000000000000000000000000000015332c31353530303038383134393939306131362c320000000000000000000000",
        "nonce": "0x2187c",
        "publicKey": "0x829019ea9bc42bbc7a182173191216d0386cbbf98cd35d2aa0126b8ccc8f94572dad6b218539e3a1692945ab905d34151ca8d1eea5c077104725ebff15277857",
        "r": "0xdede49403450d50a2db23a0f8d776fa94a6cae81ac8d803a29c47b4e6d63e3c",
        "raw": "0xf9014c8302187c843b9aca00830f424094cdbf1d1c64faad6d8484fd3dd5be2b4ea57f5f4c80b8e428fbdf0d000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000040376634613461663166336262326163646366313062656339636463336337636639313061303030336365323739313866366565323964376436626130353964360000000000000000000000000000000000000000000000000000000000000015332c31353530303038383134393939306131362c3200000000000000000000001ba00dede49403450d50a2db23a0f8d776fa94a6cae81ac8d803a29c47b4e6d63e3ca06361f099d66bdd992a4d85c9482423a9022165b40935d5623718c82c0d897f66",
        "s": "0x6361f099d66bdd992a4d85c9482423a9022165b40935d5623718c82c0d897f66",
        "standardV": "0x0",
        "to": "0xcdbf1d1c64faad6d8484fd3dd5be2b4ea57f5f4c",
        "transactionIndex": "0x1",
        "v": "0x1b",
        "value": "0x0"
      }
    ],
    "transactionsRoot": "0x6959042602c4847d263901a7d049b5565cbd511989a7d211b319fe2a96df4ed5",
    "uncles": []
  }`

	block := eth.Block{}
	err := json.Unmarshal([]byte(full), &block)
	require.NoError(t, err)

	copied := block.DeepCopy()
	b1, err := json.Marshal(&block)
	b2, err := json.Marshal(&copied)

	require.Equal(t, b1, b2)
	require.JSONEq(t, full, string(b1))
	require.JSONEq(t, full, string(b2))
}
